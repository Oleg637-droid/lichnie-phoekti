<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–¥—É–∫—Ü–∏—è | –ê–î–´–ú –ò–ù–ñ–ï–ù–ò–†–ò–ù–ì</title>
    
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .page-container {
            max-width: 1400px;
            margin: 50px auto;
            padding: 0 20px;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
            color: #333;
        }

        /* --- –°–¢–ò–õ–ò –î–õ–Ø –õ–ï–ô–ê–£–¢–ê (–°–ê–ô–î–ë–ê–† + –¢–û–í–ê–†–´) --- */
        .catalog-layout {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }
        
        .filter-sidebar {
            width: 280px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }
        
        .filter-sidebar h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
            color: #17a2b8; /* –§–∏—Ä–º–µ–Ω–Ω—ã–π –∞–∫—Ü–µ–Ω—Ç */
            border-bottom: 2px solid #17a2b8;
            padding-bottom: 5px;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .category-list {
            list-style: none;
            padding: 0;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .category-list li {
            margin-bottom: 3px;
        }
        
        .category-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 8px 10px;
            background: transparent;
            color: #333;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-weight: 400;
        }
        
        .category-btn:hover {
            background-color: #e9ecef;
            color: #17a2b8;
        }
        
        .category-btn.active {
            background-color: #17a2b8;
            color: white;
            font-weight: bold;
        }

        /* --- –°–¢–ò–õ–ò –ö–ê–†–¢–û–ß–ï–ö –¢–û–í–ê–†–ê --- */
        .product-content {
            flex-grow: 1;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            padding-bottom: 50px;
        }
        .product-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            transition: box-shadow 0.2s, transform 0.2s;
            overflow: hidden;
            cursor: pointer; /* –î–µ–ª–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π */
        }
        .product-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        /* –û–ë–õ–ê–°–¢–¨ –§–û–¢–û */
        .product-card .image-wrapper {
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f7f9fc;
            overflow: hidden;
            position: relative;
        }
        .product-card img {
            width: auto;
            max-width: 100%;
            height: auto;
            max-height: 100%;
            object-fit: contain;
        }

        /* –û–ë–õ–ê–°–¢–¨ –ò–ù–§–û–†–ú–ê–¶–ò–ò */
        .product-body {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-info h3 {
            font-size: 1.15em;
            margin: 0 0 10px 0;
            color: #333;
            font-weight: 700;
            min-height: 2.8em; 
            line-height: 1.4;
        }
        
        /* –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (SKU, –ö–∞—Ç–µ–≥–æ—Ä–∏—è) */
        .product-meta {
            font-size: 0.8em;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .product-meta .category-tag {
            display: inline-block;
            background-color: #e6f7ff;
            color: #17a2b8;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .sku-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sku-line strong {
            color: #333;
            font-weight: 500;
        }
        
        /* –§—É—Ç–µ—Ä (–¶–ï–ù–ê –∏ –ù–ê–õ–ò–ß–ò–ï) */
        .price-footer {
            margin-top: auto; 
            padding-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #eee;
        }
        
        .price {
            font-size: 1.7em;
            font-weight: 900;
            color: #dc3545;
        }
        
        /* –°—Ç–∞—Ç—É—Å –Ω–∞–ª–∏—á–∏—è */
        .stock-status {
            font-size: 0.9em;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .stock-icon {
            margin-right: 5px;
        }

        .stock-available {
            color: #28a745;
        }
        .stock-low {
            color: #ffc107;
        }
        .stock-out {
            color: #dc3545;
        }
        
        /* --- –°–¢–ò–õ–ò –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê --- */
        .modal {
            position: fixed;
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7); /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω */
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            animation-name: animatetop;
            animation-duration: 0.4s
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            line-height: 1;
            margin-top: -10px;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #17a2b8;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .modal-body-layout {
            display: flex;
            gap: 20px;
        }
        
        .modal-image-col {
            flex-shrink: 0;
            width: 40%;
            max-width: 300px;
            text-align: center;
        }
        
        .modal-image-col img {
            width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: contain;
            border-radius: 6px;
            background-color: #f7f9fc;
        }

        .modal-details-col {
            flex-grow: 1;
        }
        
        .modal-details-col p {
            margin: 8px 0;
        }
        
        .modal-details-col strong {
            display: inline-block;
            width: 120px;
            color: #6c757d;
        }
        
        .modal-price-display {
            font-size: 2em;
            font-weight: 900;
            color: #dc3545;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ccc;
        }

        /* –ú–µ–¥–∏–∞–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
        @media (max-width: 900px) {
            .catalog-layout {
                flex-direction: column;
            }
            .filter-sidebar {
                width: 100%;
                max-height: 40vh;
            }
            .category-list {
                display: flex;
                flex-wrap: nowrap;
                overflow-x: auto;
                max-height: none;
                padding: 10px 0;
            }
            .category-list li {
                flex: 0 0 auto;
                margin-right: 10px;
            }
            .category-btn {
                white-space: nowrap;
            }
            .admin-link-bar {
                text-align: center;
                margin-top: 20px;
            }
            .modal-body-layout {
                flex-direction: column;
            }
            .modal-image-col {
                width: 100%;
                max-width: none;
            }
            .modal-content {
                width: 95%;
                margin: 20px auto;
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">
            <span class="logo-text">–ê–î–´–ú –ò–ù–ñ–ï–ù–ò–†–ò–ù–ì</span>
        </div>
        
        <button class="burger-menu-btn" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">
            <span class="burger-icon"></span>
        </button>

        <nav class="navigation-menu">
            <ul>
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/products" class="active">–ü—Ä–æ–¥—É–∫—Ü–∏—è</a></li> 
                <li><a href="/services">–£—Å–ª—É–≥–∏</a></li>
                <li><a href="/about">–û –∫–æ–º–ø–∞–Ω–∏–∏</a></li>
                <li><a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                <li><a href="/pos" class="pos-link">POS-–¢–µ—Ä–º–∏–Ω–∞–ª</a></li>
            </ul>
        </nav>
    </header>

    <main class="main-content">
        <div class="page-container">
            <h1>–ö–∞—Ç–∞–ª–æ–≥ –ü—Ä–æ–¥—É–∫—Ü–∏–∏</h1>
            
            <div class="admin-link-bar">
                <a href="/admin/products/new" class="add-product-btn">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –¢–æ–≤–∞—Ä
                </a>
                <a href="/admin/categories" class="add-product-btn">
                    <i class="fas fa-list"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
                </a>
            </div>

            <div class="catalog-layout">
                
                <aside class="filter-sidebar">
                    <h3><i class="fas fa-filter"></i> –§–∏–ª—å—Ç—Ä—ã</h3>
                    <ul class="category-list" id="category-filters">
                        </ul>
                </aside>

                <div class="product-content">
                    <div class="product-grid" id="product-list-container">
                        <p id="loading-message" class="empty-message"><i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
                    </div>
                </div>
            </div>
            
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2024 –ê–î–´–ú –ò–ù–ñ–ï–ù–ò–†–ò–ù–ì. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        <div class="social-links">
            <a href="#"><i class="fab fa-whatsapp"></i></a>
            <a href="#"><i class="fab fa-telegram-plane"></i></a>
        </div>
    </footer>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            
            <div class="modal-header">
                <h2 id="modal-product-name">–ù–∞–∑–≤–∞–Ω–∏–µ –¢–æ–≤–∞—Ä–∞</h2>
            </div>
            
            <div class="modal-body-layout">
                <div class="modal-image-col">
                    <img id="modal-product-image" src="https://placehold.co/300x300?text=–ó–∞–≥—Ä—É–∑–∫–∞..." alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                </div>
                <div class="modal-details-col">
                    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> <span id="modal-category-name">...</span></p>
                    <p><strong>–ê—Ä—Ç–∏–∫—É–ª (SKU):</strong> <span id="modal-sku">...</span></p>
                    <p><strong>ID –≤ –ë–î:</strong> <span id="modal-product-id">...</span></p>
                    <p><strong>–ù–∞–ª–∏—á–∏–µ:</strong> <span id="modal-stock-status">...</span></p>
                    
                    <div class="modal-price-display" id="modal-price">... KZT</div>
                    
                    <p style="margin-top: 20px; font-style: italic; color: #6c757d;">
                        * –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ API-–º–æ–¥–µ–ª—å ProductOut.
                    </p>
                </div>
            </div>
        </div>
    </div>


    <script>
        let categoriesData = []; 
        
        // --- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ---
        const modal = document.getElementById('productModal');
        const closeBtn = document.querySelector('.close-btn');
    
        document.addEventListener('DOMContentLoaded', initProductPage);
        
        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π ---
        async function initProductPage() {
            await fetchAndRenderCategories();
            await fetchAndRenderProducts(); 
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫
            closeBtn.onclick = function() {
                modal.style.display = 'none';
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }
        }
        
        // --- –§–£–ù–ö–¶–ò–Ø 1: –ó–ê–ì–†–£–ó–ö–ê –ò –†–ï–ù–î–ï–†–ò–ù–ì –ö–ê–¢–ï–ì–û–†–ò–ô (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        async function fetchAndRenderCategories() {
            const filtersContainer = document.getElementById('category-filters');
            filtersContainer.innerHTML = '';
            
            const allItem = document.createElement('li');
            const allBtn = document.createElement('button');
            allBtn.className = 'category-btn active';
            allBtn.textContent = '–í—Å–µ —Ç–æ–≤–∞—Ä—ã';
            allBtn.addEventListener('click', () => filterProducts(null, allBtn));
            allItem.appendChild(allBtn);
            filtersContainer.appendChild(allItem);
    
            try {
                const response = await fetch('/api/categories/');
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π');
                
                categoriesData = await response.json();
                
                categoriesData.forEach(cat => {
                    const listItem = document.createElement('li');
                    const btn = document.createElement('button');
                    btn.className = 'category-btn';
                    btn.textContent = cat.name;
                    btn.addEventListener('click', () => filterProducts(cat.id, btn));
                    
                    listItem.appendChild(btn);
                    filtersContainer.appendChild(listItem);
                });
    
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
                const errorItem = document.createElement('li');
                errorItem.innerHTML = '<span style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</span>';
                filtersContainer.appendChild(errorItem);
            }
        }
        
        // --- –§–£–ù–ö–¶–ò–Ø 2: –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –ü–ï–†–ï–†–ï–ù–î–ï–†–ò–ù–ì (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        function filterProducts(categoryId, clickedButton) {
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            fetchAndRenderProducts(categoryId);
        }
        
        
        // --- –§–£–ù–ö–¶–ò–Ø 3: –ó–ê–ì–†–£–ó–ö–ê –ò –†–ï–ù–î–ï–†–ò–ù–ì –¢–û–í–ê–†–û–í (–î–û–ë–ê–í–õ–ï–ù–ò–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ê) ---
        async function fetchAndRenderProducts(categoryId = null) {
            const container = document.getElementById('product-list-container');
            container.innerHTML = '<p class="empty-message"><i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>';
            
            let url = '/api/products/';
            if (categoryId !== null) {
                 url = `/api/products/?category_id=${categoryId}`;
            }
            
            try {
                const response = await fetch(url);
                
                if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                
                const products = await response.json();
    
                container.innerHTML = ''; 
        
                if (products.length === 0) {
                    container.innerHTML = `
                        <p class="empty-message">
                            <i class="fas fa-search-dollar"></i> 
                            –¢–æ–≤–∞—Ä—ã –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
                        </p>
                    `;
                    return;
                }
        
                products.forEach(product => {
                    const stock = parseFloat(product.stock);
                    
                    let stockClass = 'stock-out';
                    let stockText = '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏';
                    let stockIcon = '<i class="fas fa-times-circle"></i>';
                    
                    if (stock > 5) {
                        stockClass = 'stock-available';
                        stockText = `–í –Ω–∞–ª–∏—á–∏–∏: ${stock.toFixed(2)}`;
                        stockIcon = '<i class="fas fa-check-circle"></i>';
                    } else if (stock > 0) {
                        stockClass = 'stock-low';
                        stockText = `–ú–∞–ª–æ: ${stock.toFixed(2)}`;
                        stockIcon = '<i class="fas fa-exclamation-triangle"></i>';
                    }
    
                    const category = categoriesData.find(c => c.id === product.category_id);
                    const categoryName = category ? category.name : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                    
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.setAttribute('data-id', product.id); 
                    
                    // üí• –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–õ–ò–ö–ê üí•
                    card.addEventListener('click', () => showProductDetails(product.id, categoryName));
    
                    const imageUrl = product.image_url || 'https://placehold.co/280x200?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º product.sku, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                    const skuDisplay = product.sku ? `<span>–ê—Ä—Ç–∏–∫—É–ª: <strong>${product.sku}</strong></span>` : '';
    
                    card.innerHTML = `
                        <div class="image-wrapper">
                            <img src="${imageUrl}" alt="${product.name}" onerror="this.onerror=null; this.src='https://placehold.co/280x200?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';">
                        </div>
                        
                        <div class="product-body">
                            <div class="product-meta">
                                <span class="category-tag">${categoryName}</span>
                            </div>
                            
                            <div class="product-info">
                                <h3>${product.name}</h3>
                                <div class="sku-line">
                                    ${skuDisplay}
                                </div>
                            </div>
                            
                            <div class="price-footer">
                                <div class="price">${parseFloat(product.price).toFixed(2)} KZT</div>
                                <div class="stock-status ${stockClass}">
                                    <span class="stock-icon">${stockIcon}</span>
                                    <span>${stockText}</span>
                                </div>
                            </div>
                        </div>
                    `;
        
                    container.appendChild(card);
                });
        
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–æ–≤:', error);
                container.innerHTML = `
                    <p class="empty-message error" style="color: #dc3545;">
                        <i class="fas fa-exclamation-circle"></i> 
                        –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–µ—Ä.
                    </p>
                `;
            }
        }
        
        // --- –§–£–ù–ö–¶–ò–Ø 4: –ó–ê–ì–†–£–ó–ö–ê –ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –î–ï–¢–ê–õ–ï–ô –í –ú–û–î–ê–õ–¨–ù–û–ú –û–ö–ù–ï (–î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø) ---
        async function showProductDetails(productId, categoryName) {
            const modalBody = document.querySelector('.modal-details-col');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏
            document.getElementById('modal-product-name').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            document.getElementById('modal-product-image').src = 'https://placehold.co/300x300?text=–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            // –û—á–∏—â–∞–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —Ä–∞–∑–º–µ—Ç–∫—É
            modalBody.innerHTML = `
                <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> <span id="modal-category-name">${categoryName}</span></p>
                <p><strong>ID –≤ –ë–î:</strong> <span id="modal-product-id">...</span></p>
                <p><strong>–ù–∞–ª–∏—á–∏–µ:</strong> <span id="modal-stock-status">...</span></p>
                <div id="product-specific-details"></div>
                <h4 style="margin-top: 20px; color: #17a2b8;"><i class="fas fa-info-circle"></i> –û–ø–∏—Å–∞–Ω–∏–µ</h4>
                <div id="modal-full-description" style="border-left: 3px solid #eee; padding-left: 10px; font-size: 0.95em;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="modal-price-display" id="modal-price">... KZT</div>
            `;
    
            modal.style.display = 'flex'; 
            
            try {
                const response = await fetch(`/api/products/${productId}`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ç–æ–≤–∞—Ä–∞');
                
                const product = await response.json();
                
                // 1. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è
                const stock = parseFloat(product.stock);
                let stockText = `–í –Ω–∞–ª–∏—á–∏–∏: ${stock.toFixed(2)}`;
                let stockColor = '#28a745'; 
                
                if (stock === 0) {
                    stockText = '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏';
                    stockColor = '#dc3545';
                } else if (stock <= 5) {
                    stockColor = '#ffc107';
                }
                
                // 2. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
                document.getElementById('modal-product-name').textContent = product.name;
                document.getElementById('modal-product-id').textContent = product.id;
                document.getElementById('modal-price').textContent = `${parseFloat(product.price).toFixed(2)} KZT`;
                
                const stockElement = document.getElementById('modal-stock-status');
                stockElement.textContent = stockText;
                stockElement.style.fontWeight = 'bold';
                stockElement.style.color = stockColor;
                
                document.getElementById('modal-full-description').textContent = product.full_description || '–ü–æ–ª–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã.';
                
                const imageUrl = product.image_url || 'https://placehold.co/300x300?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
                document.getElementById('modal-product-image').src = imageUrl;
                document.getElementById('modal-product-image').onerror = function() {
                    this.src = 'https://placehold.co/300x300?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
                };
    
                // 3. –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –†–ê–ó–ú–ï–¢–ö–ê –î–õ–Ø –®–õ–ê–ù–ì–û–í –ò –§–ò–¢–ò–ù–ì–û–í
                const specificDetailsContainer = document.getElementById('product-specific-details');
                let specificHTML = '';
    
                if (categoryName.toLowerCase().includes('—à–ª–∞–Ω–≥') || categoryName.toLowerCase().includes('—Ä–≤–¥')) {
                    // –†–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è –®–õ–ê–ù–ì–û–í
                    specificHTML = `
                        <h4 style="margin-top: 20px; color: #17a2b8;"><i class="fas fa-ruler-combined"></i> –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–®–ª–∞–Ω–≥)</h4>
                        <div style="padding-left: 10px;">
                            <p><strong>–¢–∏–ø/–°—Ç–∞–Ω–¥–∞—Ä—Ç:</strong> ${product.type_standard || '–ù/–î'}</p>
                            <p><strong>–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π D:</strong> ${product.inner_diameter ? `${product.inner_diameter} –º–º` : '–ù/–î'}</p>
                            <p><strong>–ù–∞—Ä—É–∂–Ω—ã–π D:</strong> ${product.outer_diameter ? `${product.outer_diameter} –º–º` : '–ù/–î'}</p>
                            <p><strong>–†–∞–±. –¥–∞–≤–ª–µ–Ω–∏–µ:</strong> ${product.working_pressure_bar ? `${product.working_pressure_bar} Bar` : '–ù/–î'}</p>
                            <p><strong>–†–∞–∑—Ä—ã–≤–Ω–æ–µ:</strong> ${product.burst_pressure_bar ? `${product.burst_pressure_bar} Bar` : '–ù/–î'}</p>
                        </div>
                    `;
                } else if (categoryName.toLowerCase().includes('—Ñ–∏—Ç–∏–Ω–≥') || categoryName.toLowerCase().includes('–º—É—Ñ—Ç–∞')) {
                     // –†–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è –§–ò–¢–ò–ù–ì–û–í (–ü–û–î–ì–û–¢–û–í–ö–ê)
                    specificHTML = `
                        <h4 style="margin-top: 20px; color: #17a2b8;"><i class="fas fa-link"></i> –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–§–∏—Ç–∏–Ω–≥)</h4>
                        <div style="padding-left: 10px;">
                            <p><strong>SKU/–ê—Ä—Ç–∏–∫—É–ª:</strong> ${product.sku || '–ù/–î'}</p>
                            <p><strong>–¢–∏–ø —Ä–µ–∑—å–±—ã:</strong> ${product.thread_type || '–ù/–î'} (–Ω–∞–ø—Ä–∏–º–µ—Ä, DKOL, JIC, BSP)</p>
                            <p><strong>–†–∞–∑–º–µ—Ä —Ä–µ–∑—å–±—ã:</strong> ${product.thread_size || '–ù/–î'} (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1/2", M22)</p>
                            <p><strong>–î–∏–∞–º–µ—Ç—Ä —à–ª–∞–Ω–≥–∞:</strong> ${product.hose_size || '–ù/–î'} (–¥–ª—è –æ–±–∂–∏–º–∞)</p>
                            <p><strong>–ú–∞—Ç–µ—Ä–∏–∞–ª:</strong> ${product.material || '–°—Ç–∞–ª—å'}</p>
                        </div>
                    `;
                } else {
                     // –û–±—â–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
                    specificHTML = `
                        <h4 style="margin-top: 20px; color: #17a2b8;"><i class="fas fa-box-open"></i> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è</h4>
                        <div style="padding-left: 10px;">
                            <p><strong>SKU/–ê—Ä—Ç–∏–∫—É–ª:</strong> ${product.sku || '–ù/–î'}</p>
                            <p><strong>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</strong> ${product.short_description || '–ù/–î'}</p>
                        </div>
                    `;
                }
                
                specificDetailsContainer.innerHTML = specificHTML;
    
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ—Ç–∞–ª–µ–π —Ç–æ–≤–∞—Ä–∞:', error);
                document.getElementById('modal-product-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                document.getElementById('modal-full-description').textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ.';
            }
        }
    </script>

    <script src="/static/app.js"></script>
</body>
</html>
