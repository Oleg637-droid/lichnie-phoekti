<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–¥—É–∫—Ü–∏—è | –ê–î–´–ú –ò–ù–ñ–ï–ù–ò–†–ò–ù–ì</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* ======================================= */
        /* 1. –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ò –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò         */
        /* ======================================= */
        :root {
            --primary-color: #007bff; /* Blue - –û—Å–Ω–æ–≤–Ω–æ–π –∞–∫—Ü–µ–Ω—Ç */
            --secondary-color: #17a2b8; /* Cyan/Teal - –î–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
            --danger-color: #dc3545; /* Red - –¶–µ–Ω–∞ */
            --success-color: #28a745; /* Green - –ù–∞–ª–∏—á–∏–µ */
            --warning-color: #ffc107; /* Yellow - –ú–∞–ª–æ */
            --text-color: #333;
            --light-bg: #f8f9fa;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --card-radius: 10px;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f4f6f9;
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }
        
        .page-container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-color);
            font-weight: 700;
        }

        /* –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .admin-link-bar {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }
        .admin-link-bar a {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .admin-link-bar a:hover {
            background-color: #0056b3;
        }

        /* ======================================= */
        /* 2. –õ–ï–ô–ê–£–¢ –ö–ê–¢–ê–õ–û–ì–ê (–°–ê–ô–î–ë–ê–† + –ì–†–ò–î)   */
        /* ======================================= */
        .catalog-layout {
            display: flex;
            gap: 30px;
        }

        .filter-sidebar {
            width: 280px;
            padding: 20px;
            background: white;
            border-radius: var(--card-radius);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            height: fit-content;
            flex-shrink: 0;
        }
        
        .filter-sidebar h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2em;
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .category-list {
            list-style: none;
            padding: 0;
        }
        
        .category-list li {
            margin-bottom: 5px;
        }
        
        .category-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 10px 12px;
            background: transparent;
            color: var(--text-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-weight: 500;
        }
        
        .category-btn:hover {
            background-color: var(--light-bg);
            color: var(--primary-color);
        }
        
        .category-btn.active {
            background-color: var(--secondary-color);
            color: white;
            font-weight: 700;
        }

        .product-content {
            flex-grow: 1;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            padding-bottom: 50px;
        }
        
        /* ======================================= */
        /* 3. –ö–ê–†–¢–û–ß–ö–ê –¢–û–í–ê–†–ê (PRODUCT CARD)     */
        /* ======================================= */
        .product-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: var(--card-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            transition: var(--card-shadow) 0.3s, transform 0.3s;
            overflow: hidden;
            cursor: pointer;
        }
        .product-card:hover {
            box-shadow: var(--card-shadow);
            transform: translateY(-5px);
        }
        
        /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
        .product-card .image-wrapper {
            width: 100%;
            height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-bg);
            border-bottom: 1px solid #eee;
        }
        .product-card img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        /* –¢–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .product-body {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-info h3 {
            font-size: 1.25em;
            margin: 0 0 5px 0;
            font-weight: 700;
            min-height: 3em; 
            line-height: 1.3;
        }
        
        .product-meta {
            font-size: 0.85em;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .category-tag {
            display: inline-block;
            background-color: #e6f7ff;
            color: var(--secondary-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        /* –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ */
        .short-desc {
            font-size: 0.9em;
            color: #5a5a5a;
            margin: 10px 0;
            height: 3.5em; /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –¥–ª—è 2-3 —Å—Ç—Ä–æ–∫ */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* –§—É—Ç–µ—Ä (–¶–µ–Ω–∞ –∏ –ù–∞–ª–∏—á–∏–µ) */
        .price-footer {
            margin-top: auto;
            padding-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #f0f0f0;
        }
        
        .price {
            font-size: 2em;
            font-weight: 900;
            color: var(--danger-color);
        }
        
        .stock-status {
            font-size: 0.9em;
            font-weight: 700;
            display: flex;
            align-items: center;
        }
        .stock-available { color: var(--success-color); }
        .stock-low { color: var(--warning-color); }
        .stock-out { color: var(--danger-color); }

        /* ======================================= */
        /* 4. –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û (PRODUCT MODAL)     */
        /* ======================================= */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); 
            display: none;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .modal-content {
            background-color: #fefefe;
            padding: 30px;
            border-radius: var(--card-radius);
            width: 90%;
            max-width: 950px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            position: relative;
            animation: animatetop 0.4s;
        }
        
        @keyframes animatetop {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-btn {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .modal-body-layout {
            display: flex;
            gap: 30px;
        }
        
        .modal-image-col {
            flex-shrink: 0;
            width: 40%;
            max-width: 350px;
            text-align: center;
            padding: 10px;
            background-color: var(--light-bg);
            border-radius: 8px;
        }
        
        .modal-image-col img {
            width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: contain;
            border-radius: 6px;
        }

        .modal-details-col {
            flex-grow: 1;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ */
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px 20px;
            margin-top: 15px;
            padding: 10px;
            background: #f7f7f7;
            border-radius: 6px;
        }
        
        .details-grid p {
            margin: 0;
            font-size: 0.95em;
        }
        
        .details-grid strong {
            display: inline-block;
            width: 120px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è */
            color: #555;
            font-weight: 600;
        }
        
        .modal-details-col h4 {
            margin-top: 30px;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-size: 1.1em;
            font-weight: 700;
        }

        .modal-price-display {
            font-size: 2.2em;
            font-weight: 900;
            color: var(--danger-color);
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #ccc;
        }
        
        /* ======================================= */
        /* 5. –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨                       */
        /* ======================================= */
        @media (max-width: 1000px) {
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 900px) {
            .catalog-layout {
                flex-direction: column;
            }
            .filter-sidebar {
                width: 100%;
            }
            /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
            .category-list {
                display: flex;
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 10px; /* –ß—Ç–æ–±—ã –Ω–µ –æ–±—Ä–µ–∑–∞—Ç—å —Ç–µ–Ω—å */
            }
            .category-list li {
                flex: 0 0 auto;
                margin-right: 10px;
            }
            .category-btn {
                white-space: nowrap;
            }
            .modal-body-layout {
                flex-direction: column;
            }
            .modal-image-col {
                width: 100%;
                max-width: none;
                margin-bottom: 15px;
            }
            .modal-content {
                width: 95%;
                margin: 0 auto;
            }
            .details-grid {
                grid-template-columns: 1fr; /* –û–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
                gap: 5px;
            }
            .details-grid strong {
                width: 100px;
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">
            <span class="logo-text">–ê–î–´–ú –ò–ù–ñ–ï–ù–ò–†–ò–ù–ì</span>
        </div>
        
        <nav class="navigation-menu">
            <ul>
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/products" class="active">–ü—Ä–æ–¥—É–∫—Ü–∏—è</a></li> 
                <li><a href="/services">–£—Å–ª—É–≥–∏</a></li>
                <li><a href="/about">–û –∫–æ–º–ø–∞–Ω–∏–∏</a></li>
                <li><a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                <li><a href="/pos" class="pos-link">POS-–¢–µ—Ä–º–∏–Ω–∞–ª</a></li>
            </ul>
        </nav>
    </header>

    <main class="main-content">
        <div class="page-container">
            <h1><i class="fas fa-boxes"></i> –ö–∞—Ç–∞–ª–æ–≥ –ü—Ä–æ–¥—É–∫—Ü–∏–∏</h1>
            
            <div class="admin-link-bar">
                <a href="/admin/products/new" class="add-product-btn">
                    <i class="fas fa-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –¢–æ–≤–∞—Ä
                </a>
                <a href="/admin/categories" class="add-product-btn" style="background-color: var(--secondary-color);">
                    <i class="fas fa-sitemap"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
                </a>
            </div>

            <div class="catalog-layout">
                
                <aside class="filter-sidebar">
                    <h3><i class="fas fa-filter"></i> –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                    <ul class="category-list" id="category-filters">
                    </ul>
                </aside>

                <div class="product-content">
                    <div class="product-grid" id="product-list-container">
                        <p id="loading-message" class="empty-message" style="text-align: center;"><i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
                    </div>
                </div>
            </div>
            
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2024 –ê–î–´–ú –ò–ù–ñ–ï–ù–ò–†–ò–ù–ì. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        <div class="social-links">
            <a href="#"><i class="fab fa-whatsapp"></i></a>
            <a href="#"><i class="fab fa-telegram-plane"></i></a>
        </div>
    </footer>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeModalBtn">&times;</span>
            
            <div class="modal-header">
                <h2 id="modal-product-name">–ù–∞–∑–≤–∞–Ω–∏–µ –¢–æ–≤–∞—Ä–∞</h2>
            </div>
            
            <div class="modal-body-layout">
                <div class="modal-image-col">
                    <img id="modal-product-image" src="https://placehold.co/300x300?text=–ó–∞–≥—Ä—É–∑–∫–∞..." alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                </div>
                <div class="modal-details-col">
                    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> <span id="modal-category-name">...</span></p>
                    <p><strong>–ê—Ä—Ç–∏–∫—É–ª (SKU):</strong> <span id="modal-sku">...</span></p>
                    <p><strong>–ù–∞–ª–∏—á–∏–µ:</strong> <span id="modal-stock-status">...</span></p>
                    
                    <div id="product-specific-details"></div>
                    
                    <h4 style="margin-top: 30px;"><i class="fas fa-file-alt"></i> –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</h4>
                    <div id="modal-full-description" style="border-left: 3px solid #ccc; padding-left: 15px; font-size: 0.95em; color: #555;">...</div>
                    
                    <div class="modal-price-display" id="modal-price">... KZT</div>
                </div>
            </div>
        </div>
    </div>


    <script>
        const API_BASE = '/api';
        let categoriesData = [];

        // --- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ---
        const modal = document.getElementById('productModal');
        const closeBtn = document.getElementById('closeModalBtn');
    
        document.addEventListener('DOMContentLoaded', initProductPage);
        
        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π ---
        async function initProductPage() {
            await fetchAndRenderCategories();
            await fetchAndRenderProducts();
            
            closeBtn.onclick = () => modal.style.display = 'none';
            window.onclick = (event) => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }
        }
        
        // --- –§–£–ù–ö–¶–ò–Ø 1: –ó–ê–ì–†–£–ó–ö–ê –ò –†–ï–ù–î–ï–†–ò–ù–ì –ö–ê–¢–ï–ì–û–†–ò–ô ---
        async function fetchAndRenderCategories() {
            const filtersContainer = document.getElementById('category-filters');
            filtersContainer.innerHTML = '';
            
            const allItem = document.createElement('li');
            const allBtn = document.createElement('button');
            allBtn.className = 'category-btn active';
            allBtn.textContent = '–í—Å–µ —Ç–æ–≤–∞—Ä—ã';
            allBtn.addEventListener('click', () => filterProducts(null, allBtn));
            allItem.appendChild(allBtn);
            filtersContainer.appendChild(allItem);
    
            try {
                const response = await fetch(`${API_BASE}/categories/`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π');
                
                categoriesData = await response.json();
                
                // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–µ—Å–ª–∏ —É –≤–∞—Å –ø–ª–æ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç –≤—Å–µ)
                function renderCategoryTree(categories, level = 0) {
                    const prefix = '‚Äî '.repeat(level);
                    categories.forEach(cat => {
                        const listItem = document.createElement('li');
                        const btn = document.createElement('button');
                        btn.className = 'category-btn';
                        btn.textContent = prefix + cat.name;
                        btn.addEventListener('click', () => filterProducts(cat.id, btn));
                        
                        listItem.appendChild(btn);
                        filtersContainer.appendChild(listItem);
                        
                        if (cat.children && cat.children.length > 0) {
                             renderCategoryTree(cat.children, level + 1);
                        }
                    });
                }

                renderCategoryTree(categoriesData);
    
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
                const errorItem = document.createElement('li');
                errorItem.innerHTML = '<span style="color: var(--danger-color);">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</span>';
                filtersContainer.appendChild(errorItem);
            }
        }
        
        // --- –§–£–ù–ö–¶–ò–Ø 2: –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ---
        function filterProducts(categoryId, clickedButton) {
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            fetchAndRenderProducts(categoryId);
        }
        
        // --- –§–£–ù–ö–¶–ò–Ø 3: –ó–ê–ì–†–£–ó–ö–ê –ò –†–ï–ù–î–ï–†–ò–ù–ì –¢–û–í–ê–†–û–í (–ö–ê–†–¢–û–ß–ö–ò) ---
        async function fetchAndRenderProducts(categoryId = null) {
            const container = document.getElementById('product-list-container');
            container.innerHTML = `<p class="empty-message" style="text-align: center;"><i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>`;
            
            let url = `${API_BASE}/products/`;
            if (categoryId !== null) {
                 url = `${API_BASE}/products/?category_id=${categoryId}`;
            }
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                
                const products = await response.json();
    
                container.innerHTML = ''; 
    
                if (products.length === 0) {
                    container.innerHTML = `
                        <p class="empty-message" style="text-align: center;">
                            <i class="fas fa-search-dollar"></i> 
                            –¢–æ–≤–∞—Ä—ã –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.
                        </p>
                    `;
                    return;
                }
        
                products.forEach(product => {
                    const stock = parseFloat(product.stock || 0);
                    
                    let stockClass = 'stock-out';
                    let stockText = '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏';
                    let stockIcon = '<i class="fas fa-times-circle"></i>';
                    
                    if (stock > 5) {
                        stockClass = 'stock-available';
                        stockText = `–í –Ω–∞–ª–∏—á–∏–∏: ${stock.toFixed(2)}`;
                        stockIcon = '<i class="fas fa-check-circle"></i>';
                    } else if (stock > 0) {
                        stockClass = 'stock-low';
                        stockText = `–ú–∞–ª–æ: ${stock.toFixed(2)}`;
                        stockIcon = '<i class="fas fa-exclamation-triangle"></i>';
                    }
    
                    // –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –ø–ª–æ—Å–∫–æ–º –º–∞—Å—Å–∏–≤–µ (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏—è)
                    const category = categoriesData.find(c => c.id === product.category_id);
                    const categoryName = category ? category.name : '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                    
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.setAttribute('data-id', product.id); 
                    
                    // üí• –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–õ–ò–ö–ê: –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    card.addEventListener('click', () => showProductDetails(product.id, categoryName));
    
                    const imageUrl = product.image_url || 'https://placehold.co/300x220?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
                    
                    // –î–µ—Ç–∞–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–ª–æ–∂–µ–Ω—ã –≤ product.details –∏–ª–∏ –±—ã—Ç—å –ø—É—Å—Ç—ã–º –æ–±—ä–µ–∫—Ç–æ–º {}
                    const details = product.details || {}; 
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º short_description –∏–∑ details, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                    const shortDescription = details.short_description ? 
                        `<p class="short-desc">${details.short_description}</p>` : 
                        '<p class="short-desc" style="color: #ccc;">–ù–µ—Ç –∫—Ä–∞—Ç–∫–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è</p>';
    
                    const skuDisplay = product.sku ? `<span>–ê—Ä—Ç–∏–∫—É–ª: <strong>${product.sku}</strong></span>` : '';
                    
                    card.innerHTML = `
                        <div class="image-wrapper">
                            <img src="${imageUrl}" alt="${product.name}" onerror="this.onerror=null; this.src='https://placehold.co/300x220?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';">
                        </div>
                        
                        <div class="product-body">
                            <div class="product-meta">
                                <span class="category-tag">${categoryName}</span>
                            </div>
                            
                            <div class="product-info">
                                <h3>${product.name}</h3>
                                ${shortDescription}
                            </div>
                            
                            <div class="price-footer">
                                <div class="price">${parseFloat(product.price).toFixed(2)} KZT</div>
                                <div class="stock-status ${stockClass}">
                                    <span class="stock-icon">${stockIcon}</span>
                                    <span>${stockText}</span>
                                </div>
                            </div>
                        </div>
                    `;
            
                    container.appendChild(card);
                });
            
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–æ–≤:', error);
                container.innerHTML = `
                    <p class="empty-message error" style="color: var(--danger-color); text-align: center;">
                        <i class="fas fa-exclamation-circle"></i> 
                        –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏ API.
                    </p>
                `;
            }
        }
        
        // --- –§–£–ù–ö–¶–ò–Ø 4: –ó–ê–ì–†–£–ó–ö–ê –ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –î–ï–¢–ê–õ–ï–ô –í –ú–û–î–ê–õ–¨–ù–û–ú –û–ö–ù–ï ---
        async function showProductDetails(productId, categoryName) {
            const modalDetailsCol = document.getElementById('productModal').querySelector('.modal-details-col');
            const specificDetailsContainer = document.getElementById('product-specific-details');
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—â–∏—Ö –ø–æ–ª–µ–π
            const updateGeneralInfo = (product, stockText, stockColor) => {
                document.getElementById('modal-product-name').textContent = product.name;
                document.getElementById('modal-category-name').textContent = categoryName;
                document.getElementById('modal-sku').textContent = product.sku || '–ù/–î';
                document.getElementById('modal-price').textContent = `${parseFloat(product.price).toFixed(2)} KZT`;
                
                const stockElement = document.getElementById('modal-stock-status');
                stockElement.textContent = stockText;
                stockElement.style.color = stockColor;
                
                const imageUrl = product.image_url || 'https://placehold.co/350x300?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
                document.getElementById('modal-product-image').src = imageUrl;
                document.getElementById('modal-product-image').onerror = function() {
                    this.src = 'https://placehold.co/350x300?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
                };
            };

            // 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏ –∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            updateGeneralInfo({name: '–ó–∞–≥—Ä—É–∑–∫–∞...', sku: '...', price: '0', image_url: ''}, '–ó–∞–≥—Ä—É–∑–∫–∞...', '#6c757d');
            specificDetailsContainer.innerHTML = '';
            document.getElementById('modal-full-description').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            modal.style.display = 'flex';

            try {
                const response = await fetch(`${API_BASE}/products/${productId}`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ç–æ–≤–∞—Ä–∞');
                
                const product = await response.json();
                const details = product.details || {}; // üí• –ü–æ–ª—É—á–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–µ—Ç–∞–ª–µ–π

                // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ null
                const getDetail = (key, suffix = '', defaultVal = '–ù/–î') => {
                    const val = details[key];
                    return val === null || val === undefined || val === "" ? defaultVal : `${val}${suffix}`;
                };

                // 2. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è
                const stock = parseFloat(product.stock || 0);
                let stockText = `–í –Ω–∞–ª–∏—á–∏–∏: ${stock.toFixed(2)}`;
                let stockColor = '#28a745';
                
                if (stock === 0) {
                    stockText = '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏';
                    stockColor = '#dc3545';
                } else if (stock <= 5 && stock > 0) {
                    stockColor = '#ffc107';
                }

                updateGeneralInfo(product, stockText, stockColor);
                
                // 3. –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
                const fullDesc = details.full_description ? details.full_description.replace(/\n/g, '<br>') : '–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ.';
                document.getElementById('modal-full-description').innerHTML = fullDesc;
                
                // 4. –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –†–ê–ó–ú–ï–¢–ö–ê –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö
                let specificHTML = '';
                
                if (categoryName.toLowerCase().includes('—à–ª–∞–Ω–≥') || categoryName.toLowerCase().includes('—Ä–≤–¥')) {
                    // –†–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è –®–õ–ê–ù–ì–û–í
                    specificHTML = `
                        <h4 style="margin-top: 30px;"><i class="fas fa-ruler-combined"></i> –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –†–í–î</h4>
                        <div class="details-grid">
                            <p><strong>–°—Ç–∞–Ω–¥–∞—Ä—Ç:</strong> ${getDetail('type_standard')}</p>
                            <p><strong>–ê—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> ${getDetail('reinforcement_layers')}</p>
                            <p><strong>–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π D:</strong> ${getDetail('inner_diameter', ' –º–º')}</p>
                            <p><strong>–ù–∞—Ä—É–∂–Ω—ã–π D:</strong> ${getDetail('outer_diameter', ' –º–º')}</p>
                            <p><strong>–†–∞–±–æ—á–µ–µ P:</strong> ${getDetail('working_pressure_bar', ' Bar')}</p>
                            <p><strong>–†–∞–∑—Ä—ã–≤–Ω–æ–µ P:</strong> ${getDetail('burst_pressure_bar', ' Bar')}</p>
                            <p><strong>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</strong> ${getDetail('temperature_range')}</p>
                        </div>
                    `;
                } else if (categoryName.toLowerCase().includes('—Ñ–∏—Ç–∏–Ω–≥') || categoryName.toLowerCase().includes('–º—É—Ñ—Ç–∞') || categoryName.toLowerCase().includes('–∞–¥–∞–ø—Ç–µ—Ä')) {
                     // –†–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è –§–ò–¢–ò–ù–ì–û–í
                    specificHTML = `
                        <h4 style="margin-top: 30px;"><i class="fas fa-wrench"></i> –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –§–∏—Ç–∏–Ω–≥–∞</h4>
                        <div class="details-grid">
                            <p><strong>–¢–∏–ø —Ä–µ–∑—å–±—ã:</strong> ${getDetail('thread_type')}</p>
                            <p><strong>–†–∞–∑–º–µ—Ä —Ä–µ–∑—å–±—ã:</strong> ${getDetail('thread_size')}</p>
                            <p><strong>–£–≥–æ–ª –∏–∑–≥–∏–±–∞:</strong> ${getDetail('bend_angle', '¬∞')}</p>
                            <p><strong>–í–µ—Å:</strong> ${getDetail('weight_kg', ' –∫–≥')}</p>
                        </div>
                    `;
                }
                
                specificDetailsContainer.innerHTML = specificHTML;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–µ—Ç–∞–ª–µ–π —Ç–æ–≤–∞—Ä–∞:', error);
                document.getElementById('modal-product-name').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                document.getElementById('modal-full-description').textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ.';
                document.getElementById('modal-price').textContent = '--- KZT';
            }
        }
    </script>

    </body>
</html>
