<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VORTEX POS | Кассовый Терминал (Удобный)</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="pos-body">

    <header class="header">
        <div class="logo">
            <span class="logo-text">VORTEX POS | КАССОВЫЙ ТЕРМИНАЛ</span>
        </div>
        <a href="/" class="cta-button secondary" style="padding: 10px 20px; font-size: 0.9em;">
            <i class="fas fa-home"></i> На сайт
        </a>
    </header>

    <main class="main-content pos-main">
        <div class="pos-grid-container-v3">
            
            <div class="pos-panel pos-cart-panel-v3">
                <h2 class="panel-title-cart"><i class="fas fa-shopping-basket"></i> Чек Продаж</h2>
                
                <div class="form-group scan-group">
                    <input type="text" id="scan-input" placeholder="Сканировать SKU или ID..." autofocus>
                    <label for="scan-input" class="scan-label"><i class="fas fa-barcode"></i></label>
                </div>
                <p id="cart-message" class="pos-message small-message"></p>

                <div class="cart-items-container-v3">
                    <table class="cart-table">
                        <thead>
                            <tr>
                                <th style="width: 50%;">Товар</th>
                                <th style="width: 15%;">Кол-во</th>
                                <th style="width: 20%;">Сумма</th>
                                <th style="width: 15%;"></th>
                            </tr>
                        </thead>
                        <tbody id="cart-tbody">
                            <tr class="empty-cart-row"><td colspan="4" style="text-align: center; color: #777;">Чек пуст. Сканируйте или выберите товар.</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="cart-summary">
                    <div class="summary-row total-row">
                        <span>К ОПЛАТЕ:</span>
                        <span id="total-amount">0.00 USD</span>
                    </div>
                </div>

                <div class="payment-actions">
                    <button id="complete-sale" class="cta-button primary large-button full-width">
                        <i class="fas fa-cash-register"></i> ОПЛАТИТЬ
                    </button>
                    <button id="clear-cart" class="cta-button secondary large-button full-width clear-button">
                        <i class="fas fa-undo-alt"></i> Сбросить
                    </button>
                </div>
            </div>

            <div class="pos-panel pos-catalog-panel-v3">
                <h2 class="panel-title-catalog"><i class="fas fa-cubes"></i> Быстрый Каталог</h2>
                
                <div id="product-list" class="product-list-buttons">
                    <p>Загрузка товаров...</p>
                </div>

                <div class="management-controls">
                    <button id="toggle-management" class="cta-button secondary full-width management-toggle">
                        <i class="fas fa-cog"></i> Управление Каталогом (CRUD)
                    </button>
                </div>
            </div>
        </div>

        <div id="management-modal" class="modal">
            <div class="modal-content large-modal">
                <span class="close-btn management-close-btn">&times;</span>
                <h2 style="color: var(--primary-color);">⚙️ Управление Каталогом (CRUD)</h2>
                
                <div class="crud-grid">
                    <div class="crud-form-box">
                        <h3><i class="fas fa-plus-circle"></i> Добавить Новый Товар</h3>
                        <form id="product-form" class="pos-form">
                            <div class="form-group"><input type="text" id="name" required placeholder="Имя товара"></div>
                            <div class="form-group"><input type="number" id="price" step="0.01" required placeholder="Цена (KZT)"></div>
                            <div class="form-group"><input type="text" id="sku" required placeholder="Артикул (SKU)"></div>
                            <div class="form-group"><input type="number" id="stock" step="0.01" required placeholder="Остаток на складе (Метры)"></div>
                            <div class="form-group"><input type="url" id="image_url" placeholder="URL изображения (опц.)"></div>
                            <button type="submit" class="cta-button primary full-width">Сохранить Товар</button>
                        </form>
                        <p id="form-message" class="pos-message"></p>
                    </div>

                    <div class="crud-list-box">
                        <h3><i class="fas fa-list"></i> Редактирование / Удаление</h3>
                        <p class="small-message" style="margin-bottom: 10px;">Нажмите на товар, чтобы открыть форму редактирования.</p>
                        <div id="crud-product-list" class="crud-list">
                            <p>Загрузка каталога...</p>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px; text-align: right;">
                    <button id="test-api" class="cta-button secondary"><i class="fas fa-server"></i> Проверить Backend</button>
                    <p id="api-status" class="pos-message" style="display: inline-block; margin-left: 15px;"></p>
                </div>
            </div>
        </div>
        
        <div id="edit-modal" class="modal">
             <div class="modal-content">
                <span class="close-btn edit-close-btn">&times;</span>
                <h2 style="color: var(--primary-color);">Редактировать Товар ID: <span id="edit-product-id"></span></h2>
                <form id="edit-product-form" class="pos-form">
                    <input type="hidden" id="edit-id">
                    <div class="form-group"><label for="edit-name">Имя:</label><input type="text" id="edit-name" required></div>
                    <div class="form-group"><label for="edit-price">Цена (KZT):</label><input type="number" id="edit-price" step="0.01" required></div>
                    <div class="form-group"><label for="edit-sku">Артикул (SKU):</label><input type="text" id="edit-sku" required></div>
                    <div class="form-group"><label for="edit-stock">Остаток (Метры):</label><input type="number" id="edit-stock" step="0.01" required></div>
                    <div class="form-group"><label for="edit-image_url">URL изображения:</label><input type="url" id="edit-image_url"></div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="button" id="delete-product-btn" class="cta-button large-button" style="background-color: #dc3545; flex-grow: 1;">
                            <i class="fas fa-trash"></i> Удалить
                        </button>
                        <button type="submit" class="cta-button primary large-button" style="background-color: var(--secondary-color); flex-grow: 3;">
                            <i class="fas fa-save"></i> Сохранить Изменения
                        </button>
                    </div>
                </form>
                <p id="edit-form-message" class="pos-message"></p>
            </div>
        </div>

        <div id="quick-add-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn quick-add-close-btn">&times;</span>
                <h2 style="color: var(--primary-color);">Добавить в Чек: <span id="quick-add-product-name"></span></h2>
                <p style="font-size: 1.2em; margin-bottom: 20px;">Цена: <span id="quick-add-product-price" style="font-weight: bold; color: var(--secondary-color);"></span></p>
        
                <form id="quick-add-form" class="pos-form">
                    <input type="hidden" id="quick-add-product-id">
                    
                    <div class="form-group">
                        <label for="quick-add-quantity" style="font-weight: bold;">Введите количество (метры/шт.):</label>
                        <input type="number" id="quick-add-quantity" step="0.01" min="0.01" required value="1.00" autofocus> 
                    </div>
                    
                    <button type="submit" class="cta-button primary full-width large-button">
                        <i class="fas fa-cart-plus"></i> Добавить в Чек
                    </button>
                </form>
                <p id="quick-add-message" class="pos-message"></p>
            </div>
        </div>

        <div id="payment-modal" class="modal">
            <div class="modal-content large-modal" style="max-width: 600px;">
                <span class="close-btn payment-close-btn">&times;</span>
                <h2 style="color: var(--primary-color);">Принять Оплату</h2>
                
                <div style="font-size: 1.5em; margin-bottom: 20px; padding: 10px; background-color: #f0fff0; border: 1px solid #c8e6c9; border-radius: 5px; text-align: center;">
                    К ОПЛАТЕ: <span id="payment-due-amount" style="font-weight: bold; color: #28a745;">0.00 KZT</span>
                </div>
                
                <div id="payment-mode-selection" style="margin-bottom: 20px;">
                    <h3>Выберите способ оплаты:</h3>
                    <div class="payment-options-grid">
                        <button class="payment-option-btn" data-mode="cash"><i class="fas fa-money-bill-wave"></i> Наличные</button>
                        <button class="payment-option-btn" data-mode="card"><i class="fas fa-credit-card"></i> Карта</button>
                        <button class="payment-option-btn" data-mode="qr"><i class="fas fa-qrcode"></i> QR</button>
                        <button class="payment-option-btn" data-mode="remote"><i class="fas fa-mobile-alt"></i> Удаленка</button>
                        <button class="payment-option-btn" data-mode="invoice"><i class="fas fa-file-invoice"></i> Счет на оплату</button>
                        <button class="payment-option-btn" data-mode="mixed"><i class="fas fa-layer-group"></i> Смешанная</button>
                    </div>
                </div>

                <div id="mixed-payment-block" style="border-top: 2px dashed #ddd; padding-top: 15px; display: none;">
                    <h3>Смешанная Оплата</h3>
                    
                    <div class="form-group">
                        <label for="mixed-cash-amount">Наличными (Сумма клиента):</label>
                        <input type="number" id="mixed-cash-amount" step="0.01" min="0" value="0.00" placeholder="0.00 KZT">
                    </div>

                    <div class="form-group">
                        <label for="mixed-second-mode">Вторая часть (остаток):</label>
                        <select id="mixed-second-mode">
                            <option value="card">Карта</option>
                            <option value="qr">QR</option>
                            <option value="remote">Удаленка</option>
                            <option value="invoice">Счет на оплату</option>
                            </select>
                    </div>

                    <div class="summary-mixed">
                        <p>Остаток к оплате (вторая часть): <span id="mixed-remaining-amount" style="font-weight: bold; color: #d39e00;">0.00 KZT</span></p>
                    </div>
                </div>
                
                <button id="finalize-payment-btn" class="cta-button primary large-button full-width" style="margin-top: 20px;">
                    ЗАВЕРШИТЬ ПРОДАЖУ
                </button>
                <p id="payment-message" class="pos-message" style="margin-top: 10px;"></p>
            </div>
        </div>
        
    </main>

    <script type="module" src="/static/pos.js"></script>
</body>
</html>
